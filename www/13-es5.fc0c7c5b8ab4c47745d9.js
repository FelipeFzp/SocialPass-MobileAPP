function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"3ZRc":function(e,t,n){"use strict";n.r(t),n.d(t,"AccountSettingsPageModule",(function(){return x}));var i=n("ofXK"),o=n("3Pt+"),r=n("TEn/"),a=n("tyNb"),s=n("oaxI"),c=n("80jf"),l=n("XNiG"),m=n("Kj3r"),u=n("h6xv"),d=n("fXoL"),h=n("2g2N"),f=n("5dVO"),g=n("qfBg"),p=n("a/9d"),v=n("hwGQ"),_=n("uX3w"),w=["imageInput"];function b(e,t){1&e&&(d["\u0275\u0275elementStart"](0,"small",18),d["\u0275\u0275text"](1," Nome de usu\xe1rio j\xe1 existe "),d["\u0275\u0275elementEnd"]())}function k(e,t){if(1&e){var n=d["\u0275\u0275getCurrentView"]();d["\u0275\u0275elementStart"](0,"ion-col",19),d["\u0275\u0275elementStart"](1,"ion-button",10),d["\u0275\u0275listener"]("click",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().getPicture()})),d["\u0275\u0275text"](2," Tirar foto "),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"]()}}var E,y,C=((E=function(){function e(t,n,i,o,r,a,s,c){_classCallCheck(this,e),this._toast=t,this.navCtrl=n,this._loader=i,this._userService=o,this._camera=r,this._crop=a,this._platform=s,this.modalCtrl=c,this.imageLoaded={file:null,url:""},this._nicknameSubject=new l.a,this.showNicknameExists=!1,this.isCordova=this._platform.is("cordova"),this.initForm()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.getUser((function(){return e.setForm()})),this._nicknameSubject.pipe(Object(m.a)(1e3)).subscribe((function(t){e._userService.nicknameExists(t).subscribe((function(t){!0===t?(e.showNicknameExists=!0,e.accountForm.get("nickname").setErrors({incorrect:!0})):(e.showNicknameExists=!1,e.accountForm.get("nickname").setErrors(null))}),(function(t){e._toast.showHttpError(t)}))}))}},{key:"initForm",value:function(){this.accountForm=new o.d({name:new o.a(null,o.o.required),email:new o.a(null,o.o.required),nickname:new o.a(null,[o.o.required,u.a]),bio:new o.a(null,[o.o.required])})}},{key:"setForm",value:function(){this.accountForm.get("name").setValue(this.user.name),this.accountForm.get("email").setValue(this.user.email),this.accountForm.get("nickname").setValue(this.user.nickname),this.accountForm.get("bio").setValue(this.user.bio),this.imageLoaded.url=this.user.imageUrl}},{key:"verifyIfNicknameExists",value:function(e){this._nicknameSubject.next(e)}},{key:"getUser",value:function(e){var t=this;this._loader.show(),this._userService.getLoggedUser().subscribe((function(n){t._loader.dismiss(),t.user=n,e&&e()}),(function(e){t._loader.dismiss(),t._toast.showHttpError(e)}))}},{key:"save",value:function(){var e=this;if(!this.accountForm.valid)throw this.accountForm.markAllAsTouched(),this._toast.show("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");this.accountForm.controls.bio.invalid&&this._toast.show("A biografia excedeu o limite de 165 caracteres.");var t={id:this.user.id,name:this.accountForm.get("name").value,email:this.accountForm.get("email").value,nickname:this.accountForm.get("nickname").value,bio:this.accountForm.get("bio").value,image:this.imageLoaded.file};this._loader.show(),this._userService.update(t).subscribe((function(t){e._loader.dismiss(),e._toast.show("Editado com sucesso \ud83d\ude03")}),(function(t){e._loader.dismiss(),e._toast.showHttpError(t)}))}},{key:"getCameraOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{quality:50,destinationType:this._camera.DestinationType.FILE_URI,encodingType:this._camera.EncodingType.JPEG,mediaType:this._camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e.fromGallery?this._camera.PictureSourceType.PHOTOLIBRARY:this._camera.PictureSourceType.CAMERA,targetWidth:400,targetHeight:400}}},{key:"getPicture",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isCordova?(this._loader.show(),this._camera.getPicture(this.getCameraOptions(t)).then((function(t){e._crop.crop(t).then((function(t){s.a.cordovaFilePathToFile(t).then((function(t){s.a.fileToBase64(t).then((function(n){e.imageLoaded.url=n,s.a.fileToBlob(t).then((function(t){e.imageLoaded.file=t,e._loader.dismiss()}))}))}))})).catch((function(t){e._loader.dismiss(),e._toast.show("Algo errado...")}))})).catch((function(t){e._loader.dismiss(),e._toast.show("Erro ao abrir c\xe2mera"+t)}))):this.fileInput.nativeElement.click()}},{key:"onImageSelected",value:function(e){var t=this;e.target.files&&e.target.files.length>0&&this.modalCtrl.create({component:c.a,componentProps:{file:e.target.files[0],width:600,aspectRatio:1},cssClass:"modal-40-80"}).then((function(e){e.onDidDismiss().then((function(e){if(e.data){var n=e.data;t.imageLoaded.file=n.file,t.imageLoaded.url=n.base64,t.fileInput.nativeElement.value=null}})),e.present()}))}}]),e}()).\u0275fac=function(e){return new(e||E)(d["\u0275\u0275directiveInject"](h.a),d["\u0275\u0275directiveInject"](r.M),d["\u0275\u0275directiveInject"](f.a),d["\u0275\u0275directiveInject"](g.a),d["\u0275\u0275directiveInject"](p.a),d["\u0275\u0275directiveInject"](v.a),d["\u0275\u0275directiveInject"](r.N),d["\u0275\u0275directiveInject"](r.L))},E.\u0275cmp=d["\u0275\u0275defineComponent"]({type:E,selectors:[["app-account-settings"]],viewQuery:function(e,t){var n;1&e&&d["\u0275\u0275viewQuery"](w,!0),2&e&&d["\u0275\u0275queryRefresh"](n=d["\u0275\u0275loadQuery"]())&&(t.fileInput=n.first)},decls:36,vars:6,consts:[["title","Minha conta",3,"showButtonBack"],[3,"formGroup"],[2,"margin-bottom","150px"],["position","floating"],["formControlName","name"],["formControlName","email","type","email"],["formControlName","nickname",3,"input"],["style","color: var(--ion-color-danger)",4,"ngIf"],["maxlength","72","type","text","rows","2","formControlName","bio"],[3,"size"],["size","small","color","primary","expand","block","fill","outline",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["imageInput",""],["size","6",4,"ngIf"],[2,"text-align","center"],[2,"width","150px","border-radius","50%",3,"src","error"],["avatarImg",""],["color","primary","expand","block",3,"click"],[2,"color","var(--ion-color-danger)"],["size","6"]],template:function(e,t){if(1&e){var n=d["\u0275\u0275getCurrentView"]();d["\u0275\u0275element"](0,"base-toolbar",0),d["\u0275\u0275elementStart"](1,"ion-content"),d["\u0275\u0275elementStart"](2,"form",1),d["\u0275\u0275elementStart"](3,"ion-list",2),d["\u0275\u0275elementStart"](4,"ion-item"),d["\u0275\u0275elementStart"](5,"ion-label",3),d["\u0275\u0275text"](6,"Seu nome"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275element"](7,"ion-input",4),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](8,"ion-item"),d["\u0275\u0275elementStart"](9,"ion-label",3),d["\u0275\u0275text"](10,"Seu e-mail"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275element"](11,"ion-input",5),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](12,"ion-item"),d["\u0275\u0275elementStart"](13,"ion-label",3),d["\u0275\u0275text"](14,"Nome de usu\xe1rio (nickname)"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](15,"ion-input",6),d["\u0275\u0275listener"]("input",(function(e){return t.verifyIfNicknameExists(e.target.value)})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275template"](16,b,2,0,"small",7),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](17,"ion-item"),d["\u0275\u0275elementStart"](18,"ion-label",3),d["\u0275\u0275text"](19,"Conte um pouco sobre voc\xea"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275element"](20,"ion-textarea",8),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](21,"ion-item"),d["\u0275\u0275elementStart"](22,"ion-grid"),d["\u0275\u0275elementStart"](23,"ion-row"),d["\u0275\u0275elementStart"](24,"ion-col",9),d["\u0275\u0275elementStart"](25,"ion-button",10),d["\u0275\u0275listener"]("click",(function(){return t.getPicture({fromGallery:!0})})),d["\u0275\u0275text"](26," Carregar foto "),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](27,"input",11,12),d["\u0275\u0275listener"]("change",(function(e){return t.onImageSelected(e)})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275template"](29,k,3,0,"ion-col",13),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](30,"ion-row"),d["\u0275\u0275elementStart"](31,"ion-col",14),d["\u0275\u0275elementStart"](32,"img",15,16),d["\u0275\u0275listener"]("error",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](33).src="../../../assets/images/default-avatar.png"})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](34,"ion-button",17),d["\u0275\u0275listener"]("click",(function(){return t.save()})),d["\u0275\u0275text"](35,"Salvar"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"]()}2&e&&(d["\u0275\u0275property"]("showButtonBack",!0),d["\u0275\u0275advance"](2),d["\u0275\u0275property"]("formGroup",t.accountForm),d["\u0275\u0275advance"](14),d["\u0275\u0275property"]("ngIf",t.showNicknameExists),d["\u0275\u0275advance"](8),d["\u0275\u0275property"]("size",t.isCordova?6:12),d["\u0275\u0275advance"](5),d["\u0275\u0275property"]("ngIf",t.isCordova),d["\u0275\u0275advance"](3),d["\u0275\u0275property"]("src",t.imageLoaded.url||"../../../assets/images/default-avatar.png",d["\u0275\u0275sanitizeUrl"]))},directives:[_.a,r.h,o.p,o.l,o.e,r.r,r.p,r.q,r.o,r.Q,o.k,o.c,i.j,r.F,o.g,r.l,r.z,r.g,r.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{width:var(--container-width);max-width:var(--container-max-width);margin:0 auto}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{padding:0;margin:0 12px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:var(--background-color)}"]}),E),S=n("PCNd"),x=((y=function e(){_classCallCheck(this,e)}).\u0275mod=d["\u0275\u0275defineNgModule"]({type:y}),y.\u0275inj=d["\u0275\u0275defineInjector"]({factory:function(e){return new(e||y)},imports:[[i.b,o.f,r.I,o.m,S.a,a.j.forChild([{path:"",component:C}])]]}),y)}}]);
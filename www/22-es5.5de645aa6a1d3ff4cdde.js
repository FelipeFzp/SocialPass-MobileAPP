function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{fhSy:function(e,t,n){"use strict";n.r(t),n.d(t,"RegisterPageModule",(function(){return I}));var i=n("ofXK"),r=n("3Pt+"),o=n("TEn/"),a=n("tyNb"),s=n("oaxI"),l=n("80jf"),c=n("XNiG"),m=n("Kj3r"),u=n("h6xv"),d=n("fXoL"),f=n("2g2N"),g=n("5dVO"),p=n("qfBg"),h=n("a/9d"),v=n("hwGQ"),C=n("uX3w"),w=["imageInput"];function E(e,t){1&e&&(d["\u0275\u0275elementStart"](0,"small",19),d["\u0275\u0275text"](1," Nome de usu\xe1rio j\xe1 existe "),d["\u0275\u0275elementEnd"]())}function y(e,t){if(1&e){var n=d["\u0275\u0275getCurrentView"]();d["\u0275\u0275elementStart"](0,"ion-col",20),d["\u0275\u0275elementStart"](1,"ion-button",12),d["\u0275\u0275listener"]("click",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"](2).getPicture()})),d["\u0275\u0275text"](2," Tirar foto "),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"]()}}function _(e,t){if(1&e){var n=d["\u0275\u0275getCurrentView"]();d["\u0275\u0275elementContainerStart"](0),d["\u0275\u0275elementStart"](1,"form",3),d["\u0275\u0275elementStart"](2,"ion-item"),d["\u0275\u0275elementStart"](3,"ion-label",4),d["\u0275\u0275text"](4,"Seu nome"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275element"](5,"ion-input",5),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](6,"ion-item"),d["\u0275\u0275elementStart"](7,"ion-label",4),d["\u0275\u0275text"](8,"Seu e-mail"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275element"](9,"ion-input",6),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](10,"ion-item"),d["\u0275\u0275elementStart"](11,"ion-label",4),d["\u0275\u0275text"](12,"Nome de usu\xe1rio (nickname)"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](13,"ion-input",7),d["\u0275\u0275listener"]("input",(function(e){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().verifyIfNicknameExists(e.target.value)})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275template"](14,E,2,0,"small",8),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](15,"ion-item"),d["\u0275\u0275elementStart"](16,"ion-label",4),d["\u0275\u0275text"](17,"Escolha uma senha"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](18,"small"),d["\u0275\u0275text"](19,"Minimo de 5 caracteres"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](20,"ion-input",9),d["\u0275\u0275listener"]("input",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().verifyPassword()})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](21,"ion-item"),d["\u0275\u0275elementStart"](22,"ion-label",4),d["\u0275\u0275text"](23,"Repita a senha"),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](24,"ion-input",10),d["\u0275\u0275listener"]("input",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().verifyPassword()})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](25,"ion-item"),d["\u0275\u0275elementStart"](26,"ion-grid"),d["\u0275\u0275elementStart"](27,"ion-row"),d["\u0275\u0275elementStart"](28,"ion-col",11),d["\u0275\u0275elementStart"](29,"ion-button",12),d["\u0275\u0275listener"]("click",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().getPicture({fromGallery:!0})})),d["\u0275\u0275text"](30," Carregar foto "),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](31,"input",13,14),d["\u0275\u0275listener"]("change",(function(e){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().onImageSelected(e)})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275template"](33,y,3,0,"ion-col",15),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](34,"ion-row"),d["\u0275\u0275elementStart"](35,"ion-col",16),d["\u0275\u0275element"](36,"img",17),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](37,"ion-button",18),d["\u0275\u0275listener"]("click",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275nextContext"]().register()})),d["\u0275\u0275text"](38),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementContainerEnd"]()}if(2&e){var i=d["\u0275\u0275nextContext"]();d["\u0275\u0275advance"](1),d["\u0275\u0275property"]("formGroup",i.registerForm),d["\u0275\u0275advance"](13),d["\u0275\u0275property"]("ngIf",i.showNicknameExists),d["\u0275\u0275advance"](14),d["\u0275\u0275property"]("size",i.isCordova?6:12),d["\u0275\u0275advance"](5),d["\u0275\u0275property"]("ngIf",i.isCordova),d["\u0275\u0275advance"](3),d["\u0275\u0275property"]("src",(null==i.imageLoaded?null:i.imageLoaded.url)||"../../../assets/images/default-avatar.png",d["\u0275\u0275sanitizeUrl"]),d["\u0275\u0275advance"](1),d["\u0275\u0275property"]("disabled",i.registerForm.invalid||i.sendingConfirmationEmail),d["\u0275\u0275advance"](1),d["\u0275\u0275textInterpolate1"](" ",i.sendingConfirmationEmail?"Verificando conta...":"Criar conta","")}}function x(e,t){if(1&e){var n=d["\u0275\u0275getCurrentView"]();d["\u0275\u0275elementContainerStart"](0),d["\u0275\u0275elementStart"](1,"p"),d["\u0275\u0275text"](2,"Foi enviado para o seu e-mail um c\xf3digo de 4 d\xedgitos. Por favor, digite-os abaixo."),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](3,"div",21),d["\u0275\u0275elementStart"](4,"input",22,23),d["\u0275\u0275listener"]("focus",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](5).select()}))("keyup",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](7).focus()})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](6,"input",22,24),d["\u0275\u0275listener"]("focus",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](7).select()}))("keyup",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](9).focus()})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](8,"input",22,25),d["\u0275\u0275listener"]("focus",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](9).select()}))("keyup",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](11).focus()})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementStart"](10,"input",22,26),d["\u0275\u0275listener"]("focus",(function(){return d["\u0275\u0275restoreView"](n),d["\u0275\u0275reference"](11).select()}))("keyup",(function(){d["\u0275\u0275restoreView"](n);var e=d["\u0275\u0275reference"](11),t=d["\u0275\u0275reference"](5),i=d["\u0275\u0275reference"](7),r=d["\u0275\u0275reference"](9),o=d["\u0275\u0275nextContext"]();return e.focus(),o.validateCode(t,i,r,e)})),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementEnd"](),d["\u0275\u0275elementContainerEnd"]()}}var S,k,b=((S=function(){function e(t,n,i,r,o,a,s,l){_classCallCheck(this,e),this._toast=t,this.navCtrl=n,this._loader=i,this._userService=r,this._camera=o,this._crop=a,this._platform=s,this.modalCtrl=l,this.step="register",this.sendingConfirmationEmail=!1,this.imageLoaded={file:null,url:""},this._nicknameSubject=new c.a,this.showNicknameExists=!1,this.isCordova=this._platform.is("cordova"),this.initForm()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._nicknameSubject.pipe(Object(m.a)(1e3)).subscribe((function(t){t?e._userService.nicknameExists(t).subscribe((function(t){!0===t?(e.showNicknameExists=!0,e.registerForm.get("nickname").setErrors({incorrect:!0})):(e.showNicknameExists=!1,e.registerForm.get("nickname").setErrors(null))}),(function(t){e._toast.showHttpError(t)})):e.registerForm.get("nickname").setErrors({incorrect:!0})})),this.registerForm.statusChanges.subscribe((function(t){console.log(e.registerForm)}))}},{key:"initForm",value:function(){this.registerForm=new r.d({name:new r.a(null,r.o.required),email:new r.a(null,r.o.required),nickname:new r.a(null,[r.o.required,u.a]),password:new r.a(null,[r.o.required,r.o.minLength(5)]),confirmPassword:new r.a(null,[r.o.required,r.o.minLength(5)])})}},{key:"register",value:function(){var e=this;if(!this.registerForm.valid)throw this.registerForm.markAllAsTouched(),this._toast.show("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");this.sendingConfirmationEmail=!0,this._userService.sendEmailConfirmation(this.registerForm.controls.email.value).subscribe((function(){e.step="confirmation",e.sendingConfirmationEmail=!1}),(function(t){e._toast.showHttpError(t),e.sendingConfirmationEmail=!1}))}},{key:"validateCode",value:function(e,t,n,i){var r=this;this._userService.confirmEmail(this.registerForm.controls.email.value,"".concat(e.value).concat(t.value).concat(n.value).concat(i.value)).subscribe((function(){var e,t={name:r.registerForm.get("name").value,email:r.registerForm.get("email").value,nickname:r.registerForm.get("nickname").value,password:r.registerForm.get("password").value,image:null===(e=r.imageLoaded)||void 0===e?void 0:e.file};r._loader.show(),r._userService.register(t).subscribe((function(e){r._loader.dismiss(),r._toast.show("Registrado com sucesso \ud83d\ude03"),r.navCtrl.navigateRoot("/home/card")}),(function(e){r._loader.dismiss(),r._toast.showHttpError(e)}))}),(function(){e.value="",t.value="",n.value="",i.value="",e.focus(),r._toast.show("C\xf3digo inv\xe1lido, verifique o c\xf3digo correto no seu email.")}))}},{key:"verifyIfNicknameExists",value:function(e){this._nicknameSubject.next(e)}},{key:"verifyPassword",value:function(){var e=this;setTimeout((function(){var t,n,i=e.registerForm.get("password"),r=e.registerForm.get("confirmPassword");i.value!=r.value||(null===(t=i.value)||void 0===t?void 0:t.length)<=4||(null===(n=r.value)||void 0===n?void 0:n.length)<=4?(i.setErrors({incorrect:!0}),r.setErrors({incorrect:!0})):(i.setErrors(null),r.setErrors(null))}),100)}},{key:"getCameraOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{quality:50,destinationType:this._camera.DestinationType.FILE_URI,encodingType:this._camera.EncodingType.JPEG,mediaType:this._camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e.fromGallery?this._camera.PictureSourceType.PHOTOLIBRARY:this._camera.PictureSourceType.CAMERA}}},{key:"getPicture",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isCordova?(this._loader.show(),this._camera.getPicture(this.getCameraOptions(t)).then((function(t){e._crop.crop(t).then((function(t){s.a.cordovaFilePathToFile(t).then((function(t){s.a.fileToBase64(t).then((function(n){e.imageLoaded.url=n,s.a.fileToBlob(t).then((function(t){e.imageLoaded.file=t,e._loader.dismiss()}))}))}))})).catch((function(t){e._loader.dismiss(),e._toast.show("Algo errado...")}))})).catch((function(t){e._loader.dismiss(),e._toast.show("Erro ao abrir c\xe2mera")}))):this.fileInput.nativeElement.click()}},{key:"onImageSelected",value:function(e){var t=this;e.target.files&&e.target.files.length>0&&this.modalCtrl.create({component:l.a,componentProps:{file:e.target.files[0],width:600,aspectRatio:1},cssClass:"modal-90-90"}).then((function(e){e.onDidDismiss().then((function(e){if(e.data){var n=e.data;t.imageLoaded.file=n.file,t.imageLoaded.url=n.base64,t.fileInput.nativeElement.value=null}})),e.present()}))}}]),e}()).\u0275fac=function(e){return new(e||S)(d["\u0275\u0275directiveInject"](f.a),d["\u0275\u0275directiveInject"](o.M),d["\u0275\u0275directiveInject"](g.a),d["\u0275\u0275directiveInject"](p.a),d["\u0275\u0275directiveInject"](h.a),d["\u0275\u0275directiveInject"](v.a),d["\u0275\u0275directiveInject"](o.N),d["\u0275\u0275directiveInject"](o.L))},S.\u0275cmp=d["\u0275\u0275defineComponent"]({type:S,selectors:[["app-register"]],viewQuery:function(e,t){var n;1&e&&d["\u0275\u0275viewQuery"](w,!0),2&e&&d["\u0275\u0275queryRefresh"](n=d["\u0275\u0275loadQuery"]())&&(t.fileInput=n.first)},decls:4,vars:4,consts:[["title","Crie sua conta",3,"showButtonBack"],[1,"container",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"formGroup"],["position","stacked"],["formControlName","name"],["formControlName","email","type","email"],["formControlName","nickname",3,"input"],["style","color: var(--ion-color-danger)",4,"ngIf"],["formControlName","password","type","password",3,"input"],["formControlName","confirmPassword","type","password",3,"input"],[3,"size"],["size","small","color","primary","expand","block","fill","outline",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["imageInput",""],["size","6",4,"ngIf"],[2,"text-align","center"],[2,"width","150px","border-radius","50%",3,"src"],["color","primary","expand","block",3,"disabled","click"],[2,"color","var(--ion-color-danger)"],["size","6"],[1,"digits"],["type","number",3,"focus","keyup"],["firstDigit",""],["secondDigit",""],["thirdDigit",""],["fourthDigit",""]],template:function(e,t){1&e&&(d["\u0275\u0275element"](0,"base-toolbar",0),d["\u0275\u0275elementStart"](1,"ion-content",1),d["\u0275\u0275template"](2,_,39,7,"ng-container",2),d["\u0275\u0275template"](3,x,12,0,"ng-container",2),d["\u0275\u0275elementEnd"]()),2&e&&(d["\u0275\u0275property"]("showButtonBack",!0),d["\u0275\u0275advance"](1),d["\u0275\u0275property"]("ngSwitch",t.step),d["\u0275\u0275advance"](1),d["\u0275\u0275property"]("ngSwitchCase","register"),d["\u0275\u0275advance"](1),d["\u0275\u0275property"]("ngSwitchCase","confirmation"))},directives:[C.a,o.h,i.l,i.m,r.p,r.l,r.e,o.p,o.q,o.o,o.Q,r.k,r.c,i.j,o.l,o.z,o.g,o.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   base-toolbar[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding:12px 24px;max-width:600px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;margin-top:4px;color:#a1a2a4}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .digits[_ngcontent-%COMP%]{display:flex;gap:24px;justify-content:center}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .digits[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:46px;min-height:52px;font-size:28px;text-align:center;margin:0;outline:none}"]}),S),P=n("PCNd"),I=((k=function e(){_classCallCheck(this,e)}).\u0275mod=d["\u0275\u0275defineNgModule"]({type:k}),k.\u0275inj=d["\u0275\u0275defineInjector"]({factory:function(e){return new(e||k)},imports:[[i.b,r.f,o.I,r.m,P.a,a.j.forChild([{path:"",component:b}])]]}),k)}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"3ZRc":function(e,t,n){"use strict";n.r(t),n.d(t,"AccountSettingsPageModule",(function(){return y}));var i=n("ofXK"),o=n("3Pt+"),r=n("TEn/"),a=n("tyNb"),s=n("oaxI"),c=n("80jf"),l=n("XNiG"),m=n("Kj3r"),d=n("h6xv"),u=n("fXoL"),h=n("2g2N"),g=n("5dVO"),p=n("qfBg"),f=n("a/9d"),v=n("hwGQ"),w=n("uX3w");const _=["imageInput"];function E(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"small",18),u["\u0275\u0275text"](1," Nome de usu\xe1rio j\xe1 existe "),u["\u0275\u0275elementEnd"]())}function b(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"ion-col",19),u["\u0275\u0275elementStart"](1,"ion-button",10),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().getPicture()})),u["\u0275\u0275text"](2," Tirar foto "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}}let S=(()=>{class e{constructor(e,t,n,i,o,r,a,s){this._toast=e,this.navCtrl=t,this._loader=n,this._userService=i,this._camera=o,this._crop=r,this._platform=a,this.modalCtrl=s,this.imageLoaded={file:null,url:""},this._nicknameSubject=new l.a,this.showNicknameExists=!1,this.isCordova=this._platform.is("cordova"),this.initForm()}ngOnInit(){this.getUser(()=>this.setForm()),this._nicknameSubject.pipe(Object(m.a)(1e3)).subscribe(e=>{this._userService.nicknameExists(e).subscribe(e=>{!0===e?(this.showNicknameExists=!0,this.accountForm.get("nickname").setErrors({incorrect:!0})):(this.showNicknameExists=!1,this.accountForm.get("nickname").setErrors(null))},e=>{this._toast.showHttpError(e)})})}initForm(){this.accountForm=new o.d({name:new o.a(null,o.o.required),email:new o.a(null,o.o.required),nickname:new o.a(null,[o.o.required,d.a]),bio:new o.a(null,[o.o.required])})}setForm(){this.accountForm.get("name").setValue(this.user.name),this.accountForm.get("email").setValue(this.user.email),this.accountForm.get("nickname").setValue(this.user.nickname),this.accountForm.get("bio").setValue(this.user.bio),this.imageLoaded.url=this.user.imageUrl}verifyIfNicknameExists(e){this._nicknameSubject.next(e)}getUser(e){this._loader.show(),this._userService.getLoggedUser().subscribe(t=>{this._loader.dismiss(),this.user=t,e&&e()},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}save(){if(!this.accountForm.valid)throw this.accountForm.markAllAsTouched(),this._toast.show("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");this.accountForm.controls.bio.invalid&&this._toast.show("A biografia excedeu o limite de 165 caracteres.");const e={id:this.user.id,name:this.accountForm.get("name").value,email:this.accountForm.get("email").value,nickname:this.accountForm.get("nickname").value,bio:this.accountForm.get("bio").value,image:this.imageLoaded.file};this._loader.show(),this._userService.update(e).subscribe(e=>{this._loader.dismiss(),this._toast.show("Editado com sucesso \u{1f603}")},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}getCameraOptions(e={}){return{quality:50,destinationType:this._camera.DestinationType.FILE_URI,encodingType:this._camera.EncodingType.JPEG,mediaType:this._camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e.fromGallery?this._camera.PictureSourceType.PHOTOLIBRARY:this._camera.PictureSourceType.CAMERA,targetWidth:400,targetHeight:400}}getPicture(e={}){this.isCordova?(this._loader.show(),this._camera.getPicture(this.getCameraOptions(e)).then(e=>{this._crop.crop(e).then(e=>{s.a.cordovaFilePathToFile(e).then(e=>{s.a.fileToBase64(e).then(t=>{this.imageLoaded.url=t,s.a.fileToBlob(e).then(e=>{this.imageLoaded.file=e,this._loader.dismiss()})})})}).catch(e=>{this._loader.dismiss(),this._toast.show("Algo errado...")})}).catch(e=>{this._loader.dismiss(),this._toast.show("Erro ao abrir c\xe2mera"+e)})):this.fileInput.nativeElement.click()}onImageSelected(e){e.target.files&&e.target.files.length>0&&this.modalCtrl.create({component:c.a,componentProps:{file:e.target.files[0],width:600,aspectRatio:1},cssClass:"modal-40-80"}).then(e=>{e.onDidDismiss().then(e=>{if(e.data){const t=e.data;this.imageLoaded.file=t.file,this.imageLoaded.url=t.base64,this.fileInput.nativeElement.value=null}}),e.present()})}}return e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](h.a),u["\u0275\u0275directiveInject"](r.M),u["\u0275\u0275directiveInject"](g.a),u["\u0275\u0275directiveInject"](p.a),u["\u0275\u0275directiveInject"](f.a),u["\u0275\u0275directiveInject"](v.a),u["\u0275\u0275directiveInject"](r.N),u["\u0275\u0275directiveInject"](r.L))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-account-settings"]],viewQuery:function(e,t){var n;1&e&&u["\u0275\u0275viewQuery"](_,!0),2&e&&u["\u0275\u0275queryRefresh"](n=u["\u0275\u0275loadQuery"]())&&(t.fileInput=n.first)},decls:36,vars:6,consts:[["title","Minha conta",3,"showButtonBack"],[3,"formGroup"],[2,"margin-bottom","150px"],["position","floating"],["formControlName","name"],["formControlName","email","type","email"],["formControlName","nickname",3,"input"],["style","color: var(--ion-color-danger)",4,"ngIf"],["maxlength","72","type","text","rows","2","formControlName","bio"],[3,"size"],["size","small","color","primary","expand","block","fill","outline",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["imageInput",""],["size","6",4,"ngIf"],[2,"text-align","center"],[2,"width","150px","border-radius","50%",3,"src","error"],["avatarImg",""],["color","primary","expand","block",3,"click"],[2,"color","var(--ion-color-danger)"],["size","6"]],template:function(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275element"](0,"base-toolbar",0),u["\u0275\u0275elementStart"](1,"ion-content"),u["\u0275\u0275elementStart"](2,"form",1),u["\u0275\u0275elementStart"](3,"ion-list",2),u["\u0275\u0275elementStart"](4,"ion-item"),u["\u0275\u0275elementStart"](5,"ion-label",3),u["\u0275\u0275text"](6,"Seu nome"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](7,"ion-input",4),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](8,"ion-item"),u["\u0275\u0275elementStart"](9,"ion-label",3),u["\u0275\u0275text"](10,"Seu e-mail"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](11,"ion-input",5),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](12,"ion-item"),u["\u0275\u0275elementStart"](13,"ion-label",3),u["\u0275\u0275text"](14,"Nome de usu\xe1rio (nickname)"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](15,"ion-input",6),u["\u0275\u0275listener"]("input",(function(e){return t.verifyIfNicknameExists(e.target.value)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](16,E,2,0,"small",7),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](17,"ion-item"),u["\u0275\u0275elementStart"](18,"ion-label",3),u["\u0275\u0275text"](19,"Conte um pouco sobre voc\xea"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](20,"ion-textarea",8),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](21,"ion-item"),u["\u0275\u0275elementStart"](22,"ion-grid"),u["\u0275\u0275elementStart"](23,"ion-row"),u["\u0275\u0275elementStart"](24,"ion-col",9),u["\u0275\u0275elementStart"](25,"ion-button",10),u["\u0275\u0275listener"]("click",(function(){return t.getPicture({fromGallery:!0})})),u["\u0275\u0275text"](26," Carregar foto "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](27,"input",11,12),u["\u0275\u0275listener"]("change",(function(e){return t.onImageSelected(e)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](29,b,3,0,"ion-col",13),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](30,"ion-row"),u["\u0275\u0275elementStart"](31,"ion-col",14),u["\u0275\u0275elementStart"](32,"img",15,16),u["\u0275\u0275listener"]("error",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](33).src="../../../assets/images/default-avatar.png"})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](34,"ion-button",17),u["\u0275\u0275listener"]("click",(function(){return t.save()})),u["\u0275\u0275text"](35,"Salvar"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}2&e&&(u["\u0275\u0275property"]("showButtonBack",!0),u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("formGroup",t.accountForm),u["\u0275\u0275advance"](14),u["\u0275\u0275property"]("ngIf",t.showNicknameExists),u["\u0275\u0275advance"](8),u["\u0275\u0275property"]("size",t.isCordova?6:12),u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngIf",t.isCordova),u["\u0275\u0275advance"](3),u["\u0275\u0275property"]("src",t.imageLoaded.url||"../../../assets/images/default-avatar.png",u["\u0275\u0275sanitizeUrl"]))},directives:[w.a,r.h,o.p,o.l,o.e,r.r,r.p,r.q,r.o,r.Q,o.k,o.c,i.j,r.F,o.g,r.l,r.z,r.g,r.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{width:var(--container-width);max-width:var(--container-max-width);margin:0 auto}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{padding:0;margin:0 12px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:var(--background-color)}"]}),e})();var k=n("PCNd");let y=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.b,o.f,r.I,o.m,k.a,a.j.forChild([{path:"",component:S}])]]}),e})()}}]);
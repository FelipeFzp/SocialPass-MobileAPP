(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{fhSy:function(e,t,n){"use strict";n.r(t),n.d(t,"RegisterPageModule",(function(){return P}));var i=n("ofXK"),r=n("3Pt+"),o=n("TEn/"),a=n("tyNb"),s=n("oaxI"),l=n("80jf"),c=n("XNiG"),m=n("Kj3r"),d=n("h6xv"),u=n("fXoL"),g=n("2g2N"),h=n("5dVO"),p=n("qfBg"),f=n("a/9d"),v=n("hwGQ"),w=n("uX3w");const C=["imageInput"];function E(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"small",19),u["\u0275\u0275text"](1," Nome de usu\xe1rio j\xe1 existe "),u["\u0275\u0275elementEnd"]())}function x(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"ion-col",20),u["\u0275\u0275elementStart"](1,"ion-button",12),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"](2).getPicture()})),u["\u0275\u0275text"](2," Tirar foto "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}}function _(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementContainerStart"](0),u["\u0275\u0275elementStart"](1,"form",3),u["\u0275\u0275elementStart"](2,"ion-item"),u["\u0275\u0275elementStart"](3,"ion-label",4),u["\u0275\u0275text"](4,"Seu nome"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](5,"ion-input",5),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](6,"ion-item"),u["\u0275\u0275elementStart"](7,"ion-label",4),u["\u0275\u0275text"](8,"Seu e-mail"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](9,"ion-input",6),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](10,"ion-item"),u["\u0275\u0275elementStart"](11,"ion-label",4),u["\u0275\u0275text"](12,"Nome de usu\xe1rio (nickname)"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](13,"ion-input",7),u["\u0275\u0275listener"]("input",(function(t){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().verifyIfNicknameExists(t.target.value)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](14,E,2,0,"small",8),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](15,"ion-item"),u["\u0275\u0275elementStart"](16,"ion-label",4),u["\u0275\u0275text"](17,"Escolha uma senha"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](18,"small"),u["\u0275\u0275text"](19,"Minimo de 5 caracteres"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](20,"ion-input",9),u["\u0275\u0275listener"]("input",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().verifyPassword()})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](21,"ion-item"),u["\u0275\u0275elementStart"](22,"ion-label",4),u["\u0275\u0275text"](23,"Repita a senha"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](24,"ion-input",10),u["\u0275\u0275listener"]("input",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().verifyPassword()})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](25,"ion-item"),u["\u0275\u0275elementStart"](26,"ion-grid"),u["\u0275\u0275elementStart"](27,"ion-row"),u["\u0275\u0275elementStart"](28,"ion-col",11),u["\u0275\u0275elementStart"](29,"ion-button",12),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().getPicture({fromGallery:!0})})),u["\u0275\u0275text"](30," Carregar foto "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](31,"input",13,14),u["\u0275\u0275listener"]("change",(function(t){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().onImageSelected(t)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](33,x,3,0,"ion-col",15),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](34,"ion-row"),u["\u0275\u0275elementStart"](35,"ion-col",16),u["\u0275\u0275element"](36,"img",17),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](37,"ion-button",18),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().register()})),u["\u0275\u0275text"](38),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("formGroup",e.registerForm),u["\u0275\u0275advance"](13),u["\u0275\u0275property"]("ngIf",e.showNicknameExists),u["\u0275\u0275advance"](14),u["\u0275\u0275property"]("size",e.isCordova?6:12),u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngIf",e.isCordova),u["\u0275\u0275advance"](3),u["\u0275\u0275property"]("src",(null==e.imageLoaded?null:e.imageLoaded.url)||"../../../assets/images/default-avatar.png",u["\u0275\u0275sanitizeUrl"]),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("disabled",e.registerForm.invalid||e.sendingConfirmationEmail),u["\u0275\u0275advance"](1),u["\u0275\u0275textInterpolate1"](" ",e.sendingConfirmationEmail?"Verificando conta...":"Criar conta","")}}function S(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementContainerStart"](0),u["\u0275\u0275elementStart"](1,"p"),u["\u0275\u0275text"](2,"Foi enviado para o seu e-mail um c\xf3digo de 4 d\xedgitos. Por favor, digite-os abaixo."),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](3,"div",21),u["\u0275\u0275elementStart"](4,"input",22,23),u["\u0275\u0275listener"]("focus",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](5).select()}))("keyup",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](7).focus()})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](6,"input",22,24),u["\u0275\u0275listener"]("focus",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](7).select()}))("keyup",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](9).focus()})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](8,"input",22,25),u["\u0275\u0275listener"]("focus",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](9).select()}))("keyup",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](11).focus()})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](10,"input",22,26),u["\u0275\u0275listener"]("focus",(function(){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275reference"](11).select()}))("keyup",(function(){u["\u0275\u0275restoreView"](e);const t=u["\u0275\u0275reference"](11),n=u["\u0275\u0275reference"](5),i=u["\u0275\u0275reference"](7),r=u["\u0275\u0275reference"](9),o=u["\u0275\u0275nextContext"]();return t.focus(),o.validateCode(n,i,r,t)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementContainerEnd"]()}}let y=(()=>{class e{constructor(e,t,n,i,r,o,a,s){this._toast=e,this.navCtrl=t,this._loader=n,this._userService=i,this._camera=r,this._crop=o,this._platform=a,this.modalCtrl=s,this.step="register",this.sendingConfirmationEmail=!1,this.imageLoaded={file:null,url:""},this._nicknameSubject=new c.a,this.showNicknameExists=!1,this.isCordova=this._platform.is("cordova"),this.initForm()}ngOnInit(){this._nicknameSubject.pipe(Object(m.a)(1e3)).subscribe(e=>{e?this._userService.nicknameExists(e).subscribe(e=>{!0===e?(this.showNicknameExists=!0,this.registerForm.get("nickname").setErrors({incorrect:!0})):(this.showNicknameExists=!1,this.registerForm.get("nickname").setErrors(null))},e=>{this._toast.showHttpError(e)}):this.registerForm.get("nickname").setErrors({incorrect:!0})}),this.registerForm.statusChanges.subscribe(e=>{console.log(this.registerForm)})}initForm(){this.registerForm=new r.d({name:new r.a(null,r.o.required),email:new r.a(null,r.o.required),nickname:new r.a(null,[r.o.required,d.a]),password:new r.a(null,[r.o.required,r.o.minLength(5)]),confirmPassword:new r.a(null,[r.o.required,r.o.minLength(5)])})}register(){if(!this.registerForm.valid)throw this.registerForm.markAllAsTouched(),this._toast.show("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");this.sendingConfirmationEmail=!0,this._userService.sendEmailConfirmation(this.registerForm.controls.email.value).subscribe(()=>{this.step="confirmation",this.sendingConfirmationEmail=!1},e=>{this._toast.showHttpError(e),this.sendingConfirmationEmail=!1})}validateCode(e,t,n,i){this._userService.confirmEmail(this.registerForm.controls.email.value,`${e.value}${t.value}${n.value}${i.value}`).subscribe(()=>{var e;const t={name:this.registerForm.get("name").value,email:this.registerForm.get("email").value,nickname:this.registerForm.get("nickname").value,password:this.registerForm.get("password").value,image:null===(e=this.imageLoaded)||void 0===e?void 0:e.file};this._loader.show(),this._userService.register(t).subscribe(e=>{this._loader.dismiss(),this._toast.show("Registrado com sucesso \u{1f603}"),this.navCtrl.navigateRoot("/home/card")},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})},()=>{e.value="",t.value="",n.value="",i.value="",e.focus(),this._toast.show("C\xf3digo inv\xe1lido, verifique o c\xf3digo correto no seu email.")})}verifyIfNicknameExists(e){this._nicknameSubject.next(e)}verifyPassword(){setTimeout(()=>{var e,t;const n=this.registerForm.get("password"),i=this.registerForm.get("confirmPassword");n.value!=i.value||(null===(e=n.value)||void 0===e?void 0:e.length)<=4||(null===(t=i.value)||void 0===t?void 0:t.length)<=4?(n.setErrors({incorrect:!0}),i.setErrors({incorrect:!0})):(n.setErrors(null),i.setErrors(null))},100)}getCameraOptions(e={}){return{quality:50,destinationType:this._camera.DestinationType.FILE_URI,encodingType:this._camera.EncodingType.JPEG,mediaType:this._camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e.fromGallery?this._camera.PictureSourceType.PHOTOLIBRARY:this._camera.PictureSourceType.CAMERA}}getPicture(e={}){this.isCordova?(this._loader.show(),this._camera.getPicture(this.getCameraOptions(e)).then(e=>{this._crop.crop(e).then(e=>{s.a.cordovaFilePathToFile(e).then(e=>{s.a.fileToBase64(e).then(t=>{this.imageLoaded.url=t,s.a.fileToBlob(e).then(e=>{this.imageLoaded.file=e,this._loader.dismiss()})})})}).catch(e=>{this._loader.dismiss(),this._toast.show("Algo errado...")})}).catch(e=>{this._loader.dismiss(),this._toast.show("Erro ao abrir c\xe2mera")})):this.fileInput.nativeElement.click()}onImageSelected(e){e.target.files&&e.target.files.length>0&&this.modalCtrl.create({component:l.a,componentProps:{file:e.target.files[0],width:600,aspectRatio:1},cssClass:"modal-90-90"}).then(e=>{e.onDidDismiss().then(e=>{if(e.data){const t=e.data;this.imageLoaded.file=t.file,this.imageLoaded.url=t.base64,this.fileInput.nativeElement.value=null}}),e.present()})}}return e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](g.a),u["\u0275\u0275directiveInject"](o.M),u["\u0275\u0275directiveInject"](h.a),u["\u0275\u0275directiveInject"](p.a),u["\u0275\u0275directiveInject"](f.a),u["\u0275\u0275directiveInject"](v.a),u["\u0275\u0275directiveInject"](o.N),u["\u0275\u0275directiveInject"](o.L))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-register"]],viewQuery:function(e,t){var n;1&e&&u["\u0275\u0275viewQuery"](C,!0),2&e&&u["\u0275\u0275queryRefresh"](n=u["\u0275\u0275loadQuery"]())&&(t.fileInput=n.first)},decls:4,vars:4,consts:[["title","Crie sua conta",3,"showButtonBack"],[1,"container",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"formGroup"],["position","stacked"],["formControlName","name"],["formControlName","email","type","email"],["formControlName","nickname",3,"input"],["style","color: var(--ion-color-danger)",4,"ngIf"],["formControlName","password","type","password",3,"input"],["formControlName","confirmPassword","type","password",3,"input"],[3,"size"],["size","small","color","primary","expand","block","fill","outline",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["imageInput",""],["size","6",4,"ngIf"],[2,"text-align","center"],[2,"width","150px","border-radius","50%",3,"src"],["color","primary","expand","block",3,"disabled","click"],[2,"color","var(--ion-color-danger)"],["size","6"],[1,"digits"],["type","number",3,"focus","keyup"],["firstDigit",""],["secondDigit",""],["thirdDigit",""],["fourthDigit",""]],template:function(e,t){1&e&&(u["\u0275\u0275element"](0,"base-toolbar",0),u["\u0275\u0275elementStart"](1,"ion-content",1),u["\u0275\u0275template"](2,_,39,7,"ng-container",2),u["\u0275\u0275template"](3,S,12,0,"ng-container",2),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275property"]("showButtonBack",!0),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngSwitch",t.step),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngSwitchCase","register"),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngSwitchCase","confirmation"))},directives:[w.a,o.h,i.l,i.m,r.p,r.l,r.e,o.p,o.q,o.o,o.Q,r.k,r.c,i.j,o.l,o.z,o.g,o.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   base-toolbar[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding:12px 24px;max-width:600px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:var(--background-color)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;margin-top:4px;color:#a1a2a4}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .digits[_ngcontent-%COMP%]{display:flex;gap:24px;justify-content:center}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .digits[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:46px;min-height:52px;font-size:28px;text-align:center;margin:0;outline:none}"]}),e})();var b=n("PCNd");let P=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.b,r.f,o.I,r.m,b.a,a.j.forChild([{path:"",component:y}])]]}),e})()}}]);